<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Asus&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/vue@3.2.19/dist/vue.global.prod.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <style>

    @import url('https://fonts.googleapis.com/css?family=Montserrat:400,800');

body {
    margin: 0;
    padding: 0;
    font-family: 'Montserrat', sans-serif;
    background: #f6f5f7; /* Light background color */
    color: #333; /* Darker text color */
}

.navbar {
    display: flex;
    justify-content: space-around;
    padding: 10px;
    background: #FF4B2B; /* Vibrant background color */
}

.navbar button {
    background-color: transparent; /* Transparent background for buttons */
    color: #FFFFFF; /* White text color */
    border: 1px solid #FF4B2B; /* Red border */
    padding: 10px 20px;
    cursor: pointer;
    transition: background-color 0.3s ease, color 0.3s ease;
}

.navbar button:hover {
    background-color: #FF416C; /* Hover color */
    color: #FFFFFF; /* White text on hover */
}

.slide-panel {
    position: fixed;
    top: 0;
    bottom: 0;
    width: 60%;
    background: #FF416C; /* Red-to-pink gradient */
    z-index: 1000;
    overflow: auto;
    transition: transform 0.5s ease;
    padding: 20px;
}

#profile-panel {
    left: 0;
    transform: translateX(-100%);
}

#wishlist-panel,
#message-panel {
    right: 0;
    transform: translateX(100%);
}

.overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
    z-index: 999;
    display: none;
}

.cart, .wishlist {
    height: 80%;
    overflow-y: scroll; /* Enable scrolling */
    -webkit-overflow-scrolling: touch; /* Smooth scrolling */
    scrollbar-width: none; /* Hide scrollbars */
    border-radius: 10px;
    /* Light background color */
}

.cart-box, .wishlist-box {
    background-color: #FF4B2B; /* Vibrant box background color */
    border-radius: 10px;
    padding: 10px;
    margin-top: 10px;
}

span.items {
    font-size: 2vh;
}

button.btn {
    background: #FF4B2B; /* Transparent background for buttons */
    color: black; 
    margin:4px;/* Vibrant text color */
}

button.order {
    background-color: #FF4B2B; /* Vibrant background color for order button */
    color: #FFF; /* White text */
    margin-top: 20px;
}

div.product-search {
    padding: 10px;
}

input.search_bar {
    color: #333; /* Dark text color */
    width: 60%;
    height: 30px;
    border-color: #FF4B2B; /* Vibrant border color */
    border-radius: 10px 0px 0px 10px;
    padding: 9px;
}

button.search {
    background-color: #FF4B2B; /* Vibrant button background */
    height: 30px;
    color: #FFF; /* White text */
    border-radius: 0px 10px 10px 0px;
}

div.product-list {
    border-radius: 10px;
    padding: 8px;
    background-color: #f2f2f2; /* Light background */
    margin: 10px;
    width: 70%;
}

button.addtowishlist {
    background-color: #FF4B2B; /* Vibrant red */
    font-size: 2vmin;
    height: 4vh;
}

button.removefromwishlist {
     /* Transparent background */
    border: 1px solid #FF4B2B; /* Red border */
    color: white; /* Vibrant red text */
    font-size: 2vmin;
    height: 4vh;
}

div.image_product {
    height: 30vh;
    width: 100%;
}

.carousel-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.6);
  color: white;
  border: none;
  padding: 10px;
  cursor: pointer;
  z-index: 10;
}
.carousel-container {
  width: 40%; /* Adjust to take 40%-50% of the screen width */
  height: auto; /* Allow height to adjust based on image aspect ratio */
  overflow: hidden; /* Ensure only one image is visible at a time */
  position: relative;
  margin: auto; /* Center the carousel horizontally */
}

.carousel {
  display: flex;
  transition: transform 0.5s ease; /* Smooth transition between images */
}

.carousel img {
  flex: 0 0 auto; /* Ensure images don't shrink or grow */
  width: 100%; /* Make the image fill the container */
  max-width: 100%; /* Ensure images don't exceed container width */
  height: auto; /* Maintain aspect ratio */
}

.course-panel {
    border: 1px solid #FF4B2B; /* Vibrant border color */
    border-radius: 8px;
    padding: 10px;
    background-color: #FFFFFF; /* Light background */
    max-width: 50vw;
    height: 260px;
    margin-top: 5px;
    overflow-y: auto;
    display:none;
}
.carousel-arrow.left {
  left: 5px;
}

.carousel-arrow.right {
  right: 5px;
}

.spinner-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(255, 255, 255, 0.7); /* Translucent white */
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
}

.spinner {
  border: 4px solid #f3f3f3; /* Light grey */
  border-top: 4px solid #FF4B2B; /* Blue */
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.dropdown-btn {
    border-radius: 5px;
    border: 1px solid #FF4B2B; /* Red border */
    background-color: transparent; /* Transparent background */
}

.myorders,.cart-box,.wishlist-box{
  background-color:#e38e7f ;
  padding:5px;
  border-radius: 5px;
  margin:5px;
  font-size:2vmin;
 
}

.orders{
  height: 50%;
  overflow-y: scroll; /* Enable scrolling */
  -webkit-overflow-scrolling: touch; /* Smooth scrolling */
  scrollbar-width: none; /* Hide scrollbars */
  border-radius: 10px;
}
#logout{
  position: absolute;
    bottom: 50px; /* Adjust this value as needed */
    left: 50%;
    transform: translateX(-50%);
}

td{
  text-align: center;
}


  </style>
</head>
<body id="dashboard">
  <div v-if="open" class="modal-overlay">
    <div class="modal">
        <h3>Product Ordered</h3>
        <button class="btn btn-danger" @click="open=!open">Ok</button>
    </div>
</div>
  <div v-if="loading" class="spinner-overlay">
    <div class="spinner"></div>
    </div>

<div class="navbar">
  <button onclick="openPanel('profile')" class="glyphicon glyphicon-user"></button>
  <button onclick="openPanel('wishlist')" class="glyphicon glyphicon-heart-empty text-lg"></button>
  <button onclick="openPanel('message')" class="glyphicon glyphicon-shopping-cart"></button>
</div>

<div id="profile-panel" class="slide-panel">
  <h2>{{userdetail.userName}}</h2>
  <h3> {{userdetail.userEmail}} </h3>
  <p>MY Orders<div class="orders">
    <div class='myorders' v-for="x in userdetail.orders">
      <h4> Item Name : {{x.item_name}}  </h4>
      <h4>Product_id : {{x.product_id}}</h4>
      <h4>Product_id : {{x.order_id}}</h4>
      <h4>Item Type : {{x.item_type}}</h4>
      <h4>Item price : {{x.item_price}} </h4>
      <h4>Order Date : {{x.order_date}} </h4>
      <h4>Delivery OTP : {{x.delivery_otp}} </h4>
      <h4>Order Status: <span v-if='x.order_status'>Delivered</span>
      <span v-if="!x.order_status">Pending</span> </h4>
  
    </div> 
  </div>
  <button id="logout" class="btn btn-primary absoulte bottom-4 px-4" @click="logout">LOGOUT</button></p>
</div>

<div id="wishlist-panel" class="slide-panel">
    Wishlist
  <div class="wishlist">
    <div class="wishlist-box" v-for="x in userdetail.wishlist">
      <h2>Product:{{x.item_name}}</h2>
      <span class="items">Type:{{x.item_type}}</span><br>
      <span class="items">Price:{{x.item_price}}</span>
      <br>
      <button class="btn removefromwishlist" @click="removefromwishlist(x.product_id)" >Remove From Wishlist</button>
      <button class="btn addtowishlist" v-if="checkcart(x.product_id)" @click="addtocart(x.product_id)">Add to Cart</button>
        <button class="btn removefromwishlist" v-else @click="removefromcart(x.product_id)" >Remove From Cart</button>
     
    </div> 
  </div>
  <br>
  
 



</div>

<div id="message-panel" class="slide-panel">
    Order
    <div class="cart">
        
        <form @submit.prevent="order">
      <div class="cart-box" v-for="item in userdetail.cart">
          <h2>Product:{{item.item_name}}</h2>
          <span class="items">Type:{{item.item_type}}</span><br>
          <span class="items">Price:{{item.item_price}}</span>
          <br>
          <input type="checkbox" :value="item" name="item" v-model="order_selected" @change="calculatecost">
          <button class="btn removefromwishlist" @click="removefromcart(item.product_id)" >Remove From Cart</button>

      </div>
    </div></form><br>

    Total Order : {{totalordercost}}<br>

   <center><button class="btn order" @click="order()">Order</button></center> 
</div>

<div id="overlay" class="overlay" onclick="closePanels()"></div>



<!--For Product search-->
<div class="product-search"><center> <div class="searchb" style="display: flex; align-items: center; width: 200px;">
  <input 
    class="search_bar" 
    type="text" 
    v-model="product_name_entered" 
    style="flex-grow: 1; border: 1px solid #ccc; padding: 8px; border-radius: 4px 0 0 4px;" 
  >
  <button 
    class="btn search glyphicon glyphicon-search" 
    @click="searchproduct()" 
    style="border: 1px solid #ccc; padding: 8px; border-radius: 0 4px 4px 0; background-color: #f0f0f0;" 
  ></button>
</div>
    <div class="product-list"  v-for="item in paginatedData">

      <center><div class="carousel-container">
        <div class="carousel" :style="{ transform: `translateX(-${item.currentImage * 100}%)` }">
            <img class="rounded-lg" v-for="(image, index) in item.images" :src="`data:${image.mimeType};base64,${image.imageData}`" :alt="'Product Image ' + index" :key="index">
        </div>
        <button class="carousel-arrow left" @click="nextImage(item)">&lt;</button>
        <button class="carousel-arrow right" @click="prevImage(item)">&gt;</button>
      </div></center>
      
     


        <h2>Product name :  {{item.item_name}}</h2>
        <span class="description">Price :  {{item.item_price}}</span><br>

        <button class="dropdown-btn" onclick="toggleDropdown(this)">Description</button>&nbsp;



          
        <div class="course-panel">
          <table>
            <tr>
              <th>Product ID: </th>
              <td>{{item.product_id}}</td>
            </tr>
            <tr>
              <th>Product Dealer Name: </th>
              <td>{{item.dealerName}}</td>
            </tr>
            <tr>
              <th>Orders: </th>
              <td>{{item.orders.length}}</td>
            </tr>
            <tr>
              <th>Company: </th>
              <td>{{item.company}}</td>
            </tr>
            <tr>
              <th>Description</th>
              <td>{{item.description}}</td>
            </tr>
          </table>
        </div><br>
        
        <br><button class="btn addtowishlist" v-if="checkwishlist(item.product_id)" @click="addtowishlist(item.product_id)">Add to Wishlist</button>
        <button class="btn removefromwishlist" v-else @click="removefromwishlist(item.product_id)" >Remove From Wishlist</button> &nbsp
        <button class="btn addtowishlist" v-if="checkcart(item.product_id)" @click="addtocart(item.product_id)">Add to Cart</button>
        <button class="btn removefromwishlist" v-else @click="removefromcart(item.product_id)" >Remove From Cart</button>

    </div>
  </center>
</div>

<!--Pagination -->
<center><div>
    <button class="btn btn-secondary text-sm bg-blue-900 px-4 rounded-md" @click="previousPage" :disabled="currentPage === 1">Previous</button>
    <span>Page {{ currentPage }} of {{ totalPages }}</span>
    <button class="btn btn-secondary text-sm bg-blue-900 px-4 rounded-md" @click="nextPage" :disabled="currentPage === totalPages">Next</button>
  </div></center>
<script>
  function openPanel(panelId) {
    closePanels(); // Close all panels before opening the new one

    document.getElementById('overlay').style.display = 'block';

    const panel = document.getElementById(panelId + '-panel');
    if (panelId === 'profile') {
      panel.style.transform = 'translateX(0)';
    } else {
      panel.style.transform = 'translateX(0)';
    }
  }

  function closePanels() {
    document.getElementById('overlay').style.display = 'none';

    const panels = document.querySelectorAll('.slide-panel');
    panels.forEach(panel => {
      if (panel.id === 'profile-panel') {
        panel.style.transform = 'translateX(-100%)';
      } else {
        panel.style.transform = 'translateX(100%)';
      }
    });
  }

  function toggleDropdown(btn) {
    var panel = btn.nextElementSibling;
    if (panel.style.display === "block") {
        panel.style.display = "none";
    } else {
        panel.style.display = "block";
    }
}


  const token = sessionStorage.getItem('token')
    const isRefreshing = performance.navigation.type === 1;
    if (!token ) {
      window.location.href = 'loginpage.html';
    }



    const app=Vue.createApp({
        data(){
            return{
                product_data:[],
                userdetail:[],
                count:[{
                    item:1,
                    cost:200
                }
              ],
                order_selected:[],
                totalordercost:0,
                product_name_entered:'',
                currentPage: 1,
                pageSize: 5,
                imageUrl:'download.jpg',
                loading:true,
                open:false

            }
        },
        computed: {
            totalPages() {
              return Math.ceil(this.product_data.length / this.pageSize);
            },
            paginatedData() {
              const startIndex = (this.currentPage - 1) * this.pageSize;
              const endIndex = startIndex + this.pageSize;
              return this.product_data.slice(startIndex, endIndex);
            }
          },
        created(){
            this.getuserdata()
            this.getallproduct()
        },
        methods:{
          nextImage(item) {
            if (item.currentImage < item.images.length - 1) {
                item.currentImage++;
            } else {
                item.currentImage = 0; // Loop back to the first image
            }
        },
        prevImage(item) {
            if (item.currentImage > 0) {
                item.currentImage--;
            } else {
                item.currentImage = item.images.length - 1; // Loop back to the last image
            }
        },
          async getallproduct(){
            try{
              this.loading=true

              let response=await axios.get('https://x-shop-server.onrender.com/getallproduct',{
                headers:{
                  Authorization:token
                }
              })

              if(response.status===200){this.loading = false;
                this.product_data=response.data
              }else{this.loading = false;
                alert("Unable to fetch all product")
              }

            }catch(error){this.loading = false;
              alert("error in get all product")
              alert(error)
            }
          }
          ,
          async removefromcart(i){
            try{
              this.loading=true
              let response=await axios.post('https://x-shop-server.onrender.com/removefromcart',{
                product_id:i
              },{
                headers:{
                  Authorization: token 
                }
              })

              if(response.status===200){
                this.loading = false;
                this.getuserdata()

              }

            }catch(error){this.loading = false;
              alert(error)
              alert(response.data.message)
            }
          },
          async removefromwishlist(i){
            try{
              this.loading=true
              let response=await axios.post('https://x-shop-server.onrender.com/removefromwishlist',{
                product_id:i
              },{
                headers:{
                  Authorization: token 
                }
              })

              if(response.status===200){
                this.loading = false;
                this.getuserdata()

              }

            }catch(error){this.loading = false;
              alert(error)
            }
          },
            async getuserdata(){
                try{
                  this.loading=true
                    let response=await axios.get('https://x-shop-server.onrender.com/getuserdata',{
                        headers:{
                          Authorization: token 
                        }
                    })

                    if(response.status===200){this.loading = false;
                        this.userdetail=response.data
                    }
                }catch(error){this.loading = false;
                    alert(error)
                
            }
            },
            calculatecost(){
                this.totalordercost=0
               this.order_selected.forEach(x=>{
                this.totalordercost=this.totalordercost+x.item_price
               })
            },
           async order(){
              try{
                this.loading=true
                let response=await axios.post('https://x-shop-server.onrender.com/orderproceed',{
                  order:this.order_selected
                },{
                  headers:{
                    Authorization: token 
                  }
                })

                if(response.status===200){
                  this.loading = false;
                  this.open=true
                  this.order_selected=[];
                  this.totalordercost=0;
                  this.getuserdata()

                }else{
                  this.loading = false;
                }

              }catch(error){this.loading = false;
                alert(error)
              }


            },
            async searchproduct(){
                try{
                  this.loading=true
                     if(this.product_name_entered){
                     
                        let response = await axios.post('https://x-shop-server.onrender.com/getproductdetail',{
                            search_product:this.product_name_entered
                        },{
                            headers:{
                              Authorization: token 
                            }
                        })

                        if(response.status===200){
                          this.loading = false;
                          this.product_data=response.data
                          if(!response.data){this.loading = false;
                            this.getallproduct()
                          }else{
                            this.loading = false;
                          }
                            
                        }else{this.loading = false;
                            alert('Failed to Get Data')
                        }
                    }

                }catch(error){
                  this.loading = false;
                    alert(error)
                }

            },
            nextPage() {
              if (this.currentPage < this.totalPages) {
                this.currentPage++;
              }
            },
            previousPage() {
              if (this.currentPage > 1) {
                this.currentPage--;
              }
            },
            checkwishlist(i){
              let check=this.userdetail.wishlist.some(obj=>obj.product_id===i)
              if(!check){
                return true
              }else{
                return false
              }

              
            },
            async addtowishlist(i){
              try{
                this.loading = true;

                let response=await axios.post('https://x-shop-server.onrender.com/addtowishlist',{
                  item:i
                },{
                  headers:{
                    Authorization: token 
                  }
                })


                if(response.status===200){
                  this.loading = false;
                  this.getuserdata()
                }else{
                  this.loading = false;
                }

              }catch(error){this.loading = false;
                alert(error)
              }
              


            },
            async addtocart(i){
              try{this.loading = true;
                let response=await axios.post('https://x-shop-server.onrender.com/addtocart',{
                  id:i
                },{
                  headers:{
                    Authorization: token 
                  }
                })
    
                if(response.status===200){
                  this.loading = false;
                  
                  this.getuserdata()
                }else{this.loading = false;}
    
              }catch(error){this.loading = false;
                alert(error)
              }
            },
            checkcart(i){
              let check=this.userdetail.cart.some(obj=>obj.product_id===i)
              if(!check){
                return true
              }else{
                return false
              }
    
              
            },logout(){
              this.loading=true
              sessionStorage.removeItem('token');
              window.location.href = 'loginpage.html';
          }
        }

        
    })

    app.mount('#dashboard')

</script>

</body>
</html>
