<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Menu Bar with Sliding Panels</title>
  <link href="https://fonts.googleapis.com/css2?family=Asus&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/vue@3.2.19/dist/vue.global.prod.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <style>

    @font-face {
        font-family: 'MyCustomFont';
        src: url('rog.ttf') format('truetype'); /* Define the source */
      }
    body {
      margin: 0;
      padding: 0;
      font-family: 'MyCustomFont', sans-serif;
      background-color: #111;
      color: #eee;
    }
    .navbar {
      display: flex;
      justify-content: space-around;
      padding: 10px;
      background-color: #333;
      
    }
    .navbar button {
      background-color: #333;
      color: #eee;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .navbar button:hover {
      background-color: #777;
    }
    .slide-panel {
      position: fixed;
      top: 0;
      bottom: 0;
      width: 60%;
      background-color: #222;
      z-index: 1000;
      overflow: auto;
      transition: transform 0.5s ease;
      padding: 20px;
    }
    #profile-panel {
      left: 0;
      transform: translateX(-100%);
    }
    #wishlist-panel,
    #message-panel {
      right: 0;
      transform: translateX(100%);
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      display: none;
    }
    .cart,.wishlist{
        height:80%;
        overflow-y: scroll; /* Enable scrolling */
        -webkit-overflow-scrolling: touch; /* Smooth scrolling */
        scrollbar-width: none;
        border-radius: 10px;

    }

   .cart::-webkit-scrollbar {
        display: none; /* Hide scrollbar in WebKit browsers */
      }

    .wishlist::-webkit-scrollbar {
        display: none; /* Hide scrollbar in WebKit browsers */
      }


    .cart-box,.wishlist-box{
        background-color:rgb(95, 84, 84);
        border-radius: 10px;
        padding:10px;
        margin-top: 10px;
        

    }

    .wishlist::-webkit-scrollbar-track {
        background:red; /* Light gray track */
      }

    span.items{
        font-size: 2vh;


      }

    button{
        background-color: black;
    }

    button.order{
        background-color: white;
        color:#111;
        margin-top: 20px;
    }

    div.product-search{
        padding:10px;
    }

    input.search_bar{
        color:black;
        width:60%;
        height:30px;
        border-color:#eee;
        border-radius: 10px 0px 0px 10px;
        padding:9px
    }
    button.search{
        background-color: white;
        height:30px;
        color:black;
        border-radius: 0px 10px 10px 0px;
    }

    div.product-list{
        border-radius:10px;
        padding:8px;
        background-color: #333;
        margin: 10px;
        width:70%;
    }
    button.addtowishlist{
      background-color: crimson;
      font-size: 1.8vmin;
      height:4vh;
    }
    button.removefromwishlist{
  
      font-size: 1.8vmin;
      height:4vh;
    }

    div.image_product{
      height:30vh;
      width:100%;
    }

    .course-panel {
      border: 1px solid #ccc;
      border-radius: 8px;
     transition: 2s;
   
      display: none;
      padding: 10px;
      background-color: #f9f9f9;
      max-width: 50vw;
      height:260px;
      margin-top: 5px;
      overflow-y:auto;
  }

  .carousel-container {
    position: relative;
    overflow: hidden;
    width: 20vw; /* 20% of the viewport width */
    height: 20vw; /* Keeping it proportional */
}

.carousel {
    display: flex;
    transition: transform 0.3s ease; /* Smoother transition */
}

.carousel img {
    width: 20vw; /* Keep the image width consistent */
    height: 20vw; /* Adjust height to maintain proportions */
    object-fit: cover; /* Ensure images fit within the defined area */
}

.carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.6); /* Semi-transparent background for the arrows */
    color: white;
    border: none;
    padding: 10px;
    cursor: pointer;
    z-index: 10;
}

.carousel-arrow.left {
    left: 5px; /* Position to the left */
}

.carousel-arrow.right {
    right: 5px; /* Position to the right */
}


.course-panel {
  border: 1px solid #ccc;
  border-radius: 8px;
 

  display: none;
  padding: 10px;
  
  max-width: 50vw;
  height:260px;
  margin-top: 5px;
  overflow-y:auto;
}

table {
  color:black;
  border-collapse: collapse; /* Ensures no spacing between cells */
  width: 100%; /* Makes the table take the full width of the container */
}
th, td {
   /* Adds a border around each cell */
  padding: 8px; /* Adds some space around the content */
  text-align: left; /* Aligns text to the left */
}
th {
  background-color: #f2f2f2; /* Light gray background for header cells */
}

div.myorders{
  background-color: whitesmoke;
  border-radius: 8px;
  color:black;
  overflow-y: auto;
  padding:5px;
  margin:5px;
}

.spinner-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(255, 255, 255, 0.7); /* Translucent white */
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
}

.spinner {
  border: 4px solid #f3f3f3; /* Light grey */
  border-top: 4px solid #3498db; /* Blue */
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}


  </style>
</head>
<body id="dashboard">
  <div v-if="open" class="modal-overlay">
    <div class="modal">
        <h3>Product Ordered</h3>
        <button class="btn btn-danger" @click="open=!open">Ok</button>
    </div>
</div>
  <div v-if="loading" class="spinner-overlay">
    <div class="spinner"></div>
    </div>

<div class="navbar">
  <button onclick="openPanel('profile')" class="glyphicon glyphicon-user"></button>
  <button onclick="openPanel('wishlist')" class="glyphicon glyphicon-heart-empty text-lg"></button>
  <button onclick="openPanel('message')" class="glyphicon glyphicon-shopping-cart"></button>
</div>

<div id="profile-panel" class="slide-panel">
  <h2>{{userdetail.userName}}</h2>
  <h3> {{userdetail.userEmail}} </h3>
  <p>MY Orders<div class='myorders' v-for="x in userdetail.orders">
    <h4> Item Name : {{x.item_name}}  </h4>
    <h4>Product_id : {{x.product_id}}</h4>
    <h4>Product_id : {{x.order_id}}</h4>
    <h4>Item Type : {{x.item_type}}</h4>
    <h4>Item price : {{x.item_price}} </h4>
    <h4>Order Date : {{x.order_date}} </h4>
    <h4>Delivery OTP : {{x.delivery_otp}} </h4>

  </div> </p>
</div>

<div id="wishlist-panel" class="slide-panel">
    Wishlist
  <div class="wishlist">
    <div class="wishlist-box" v-for="x in userdetail.wishlist">
      <h2>Product:{{x.product_name}}</h2>
      <span class="items">Type:{{x.product_type}}</span><br>
      <span class="items">Price:{{x.product_price}}</span>
      <br>
      <button class="btn removefromwishlist" @click="removefromwishlist(x.product_id)" >remove From wishlist</button>
      <button class="btn addtowishlist" v-if="checkcart(x.product_id)" @click="addtocart(x.product_id)">Add to Cart</button>
        <button class="btn removefromwishlist" v-else @click="removefromcart(x.product_id)" >remove From Cart</button>
     
    </div> 
  </div>
  <br>
  
 



</div>

<div id="message-panel" class="slide-panel">
    Order
    <div class="cart">
        
        <form @submit.prevent="order">
      <div class="cart-box" v-for="item in userdetail.cart">
          <h2>Product:{{item.product_name}}</h2>
          <span class="items">Type:{{item.item_type}}</span><br>
          <span class="items">Price:{{item.item_price}}</span>
          <br>
          <input type="checkbox" :value="item" name="item" v-model="order_selected" @change="calculatecost">
          <button class="btn removefromwishlist" @click="removefromcart(item.product_id)" >remove From Cart</button>

      </div>
    </div></form><br>

    Total Order : {{totalordercost}}<br>

   <center><button class="btn order" @click="order()">Order</button></center> 
</div>

<div id="overlay" class="overlay" onclick="closePanels()"></div>



<!--For Product search-->
<div class="product-search"><center> <input class="search_bar" type="text" v-model="product_name_entered"><button class="btn search" @click="searchproduct()">Search</button> 
    <div class="product-list"  v-for="item in paginatedData">

      <center><div class="carousel-container">
        <div class="carousel" :style="{ transform: `translateX(-${item.currentImage * 100}%)` }">
            <img v-for="(image, index) in item.images" :src="`data:${image.mimeType};base64,${image.imageData}`" :alt="'Product Image ' + index" :key="index">
        </div>
        <button class="carousel-arrow left" @click="prevImage(item)">&lt;</button>
        <button class="carousel-arrow right" @click="nextImage(item)">&gt;</button>
      </div></center>
      
     


        <h2>Product name :  {{item.item_name}}</h2>
        <span class="description">Price :  {{item.item_price}}</span><br>

        <button class="dropdown-btn" onclick="toggleDropdown(this)">description</button>&nbsp;



          
        <div class="course-panel">
          <table>
            <tr>
              <th>Product ID</th>
              <td>{{item.product_id}}</td>
            </tr>
            <tr>
              <th>Product Dealer Name</th>
              <td>{{item.dealerName}}</td>
            </tr>
            <tr>
              <th>Orders</th>
              <td>{{item.orders.length}}</td>
            </tr>
            <tr>
              <th>Company </th>
              <td>{{item.company}}</td>
            </tr>
          </table>
        </div><br>
        
        <br><button class="btn addtowishlist" v-if="checkwishlist(item.product_id)" @click="addtowishlist(item.product_id)">Add to Wishlist</button>
        <button class="btn removefromwishlist" v-else @click="removefromwishlist(item.product_id)" >remove From wishlist</button> &nbsp
        <button class="btn addtowishlist" v-if="checkcart(item.product_id)" @click="addtocart(item.product_id)">Add to Cart</button>
        <button class="btn removefromwishlist" v-else @click="removefromcart(item.product_id)" >remove From Cart</button>

    </div>
  </center>
</div>

<!--Pagination -->
<center><div>
    <button class="btn btn-secondary text-sm bg-blue-900 px-4 rounded-md" @click="previousPage" :disabled="currentPage === 1">Previous</button>
    <span>Page {{ currentPage }} of {{ totalPages }}</span>
    <button class="btn btn-secondary text-sm bg-blue-900 px-4 rounded-md" @click="nextPage" :disabled="currentPage === totalPages">Next</button>
  </div></center>
<script>
  function openPanel(panelId) {
    closePanels(); // Close all panels before opening the new one

    document.getElementById('overlay').style.display = 'block';

    const panel = document.getElementById(panelId + '-panel');
    if (panelId === 'profile') {
      panel.style.transform = 'translateX(0)';
    } else {
      panel.style.transform = 'translateX(0)';
    }
  }

  function closePanels() {
    document.getElementById('overlay').style.display = 'none';

    const panels = document.querySelectorAll('.slide-panel');
    panels.forEach(panel => {
      if (panel.id === 'profile-panel') {
        panel.style.transform = 'translateX(-100%)';
      } else {
        panel.style.transform = 'translateX(100%)';
      }
    });
  }

  function toggleDropdown(btn) {
    var panel = btn.nextElementSibling;
    if (panel.style.display === "block") {
        panel.style.display = "none";
    } else {
        panel.style.display = "block";
    }
}


  const token = sessionStorage.getItem('token')
    const isRefreshing = performance.navigation.type === 1;
    if (!token ) {
      window.location.href = 'adminlogin.html';
    }



    const app=Vue.createApp({
        data(){
            return{
                product_data:[],
                userdetail:[],
                count:[{
                    item:1,
                    cost:200
                }
              ],
                order_selected:[],
                totalordercost:0,
                product_name_entered:'',
                currentPage: 1,
                pageSize: 5,
                imageUrl:'download.jpg',
                loading:true,
                open:false

            }
        },
        computed: {
            totalPages() {
              return Math.ceil(this.product_data.length / this.pageSize);
            },
            paginatedData() {
              const startIndex = (this.currentPage - 1) * this.pageSize;
              const endIndex = startIndex + this.pageSize;
              return this.product_data.slice(startIndex, endIndex);
            }
          },
        created(){
            this.getuserdata()
            this.getallproduct()
        },
        methods:{
          nextImage(item) {
            if (item.currentImage < item.images.length - 1) {
                item.currentImage++;
            } else {
                item.currentImage = 0; // Loop back to the first image
            }
        },
        prevImage(item) {
            if (item.currentImage > 0) {
                item.currentImage--;
            } else {
                item.currentImage = item.images.length - 1; // Loop back to the last image
            }
        },
          async getallproduct(){
            try{
              this.loading=true

              let response=await axios.get('http://localhost:8080/getallproduct',{
                headers:{
                  Authorization:token
                }
              })

              if(response.status===200){
                this.product_data=response.data
              }else{
                alert("Unable to fetch all product")
              }

            }catch(error){
              alert("error in get all product")
              alert(error)
            }finally{
              this.loading=false
            }
          }
          ,
          async removefromcart(i){
            try{
              this.loading=true
              let response=await axios.post('http://localhost:8080/removefromcart',{
                product_id:i
              },{
                headers:{
                  Authorization: token 
                }
              })

              if(response.status===200){
                
                this.getuserdata()

              }

            }catch(error){
              alert(error)
            }finally{
              this.loading=false
            }
          },
          async removefromwishlist(i){
            try{
              this.loading=true
              let response=await axios.post('http://localhost:8080/removefromwishlist',{
                product_id:i
              },{
                headers:{
                  Authorization: token 
                }
              })

              if(response.status===200){
                
                this.getuserdata()

              }

            }catch(error){
              alert(error)
            }finally{
              this.loading=false
            }
          },
            async getuserdata(){
                try{
                  this.loading=true
                    let response=await axios.get('http://localhost:8080/getuserdata',{
                        headers:{
                          Authorization: token 
                        }
                    })

                    if(response.status===200){
                        this.userdetail=response.data
                    }
                }catch(error){
                    alert(error)
                
            }finally{
              this.loading=false
            }
            },
            calculatecost(){
                this.totalordercost=0
               this.order_selected.forEach(x=>{
                this.totalordercost=this.totalordercost+x.item_price
               })
            },
           async order(){
              try{
                this.loading=true
                let response=await axios.post('http://localhost:8080/orderproceed',{
                  order:this.order_selected
                },{
                  headers:{
                    Authorization: token 
                  }
                })

                if(response.status===200){
                  this.open=true
                  this.order_selected=[];
                  this.totalordercost=0;
                  this.getuserdata()

                }

              }catch(error){
                alert(error)
              }finally{
                this.loading=false
                
              }


            },
            async searchproduct(){
                try{
                  this.loading=true
                     if(this.product_name_entered){
                      alert("searching product")
                        let response = await axios.post('http://localhost:8080/getproductdetail',{
                            search_product:this.product_name_entered
                        },{
                            headers:{
                              Authorization: token 
                            }
                        })

                        if(response.status===200){
                          this.product_data=response.data
                          if(!response.data){
                            this.getallproduct()
                          }
                            
                        }else{
                            alert('Failed to Get Data')
                        }
                    }

                }catch(error){
                    alert(error)
                }finally{
                  this.loading=false
                }

            },
            nextPage() {
              if (this.currentPage < this.totalPages) {
                this.currentPage++;
              }
            },
            previousPage() {
              if (this.currentPage > 1) {
                this.currentPage--;
              }
            },
            checkwishlist(i){
              let check=this.userdetail.wishlist.some(obj=>obj.product_id===i)
              if(!check){
                return true
              }else{
                return false
              }

              
            },
            async addtowishlist(i){
              try{

                let response=await axios.post('http://localhost:8080/addtowishlist',{
                  item:i
                },{
                  headers:{
                    Authorization: token 
                  }
                })


                if(response.status===200){
                  this.getuserdata()
                }

              }catch(error){
                alert(error)
              }
              


            },
            async addtocart(i){
              try{
                let response=await axios.post('http://localhost:8080/addtocart',{
                  id:i
                },{
                  headers:{
                    Authorization: token 
                  }
                })
    
                if(response.status===200){
                  
                  this.getuserdata()
                }
    
              }catch(error){
                alert(error)
              }
            },
            checkcart(i){
              let check=this.userdetail.cart.some(obj=>obj.product_id===i)
              if(!check){
                return true
              }else{
                return false
              }
    
              
            }
        }

        
    })

    app.mount('#dashboard')

</script>

</body>
</html>
